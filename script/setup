#!/bin/sh

set -e

echo "  ____ ____  ______ __ __  ___  ____  __ __ __  _____"
echo " /    |    \|      |  |  |/   \|    \|  |  |  |/ ___/"
echo "|  o  |  _  |      |  |  |     |  _  |  |  |_ (   \_ "
echo "|     |  |  |_|  |_|  _  |  O  |  |  |  ~  | \|\__  |"
echo "|  _  |  |  | |  | |  |  |     |  |  |___, |   /  \ |"
echo "|  |  |  |  | |  | |  |  |     |  |  |     |   \    |"
echo "|__|__|__|__| |__| |__|__|\___/|__|__|____/     \___|"
echo "                                                     "
echo " ___    ___  ______      _____ ____ _       ___ _____"
echo "|   \  /   \|      |    |     |    | |     /  _] ___/"
echo "|    \|     |      |    |   __||  || |    /  [(   \_ "
echo "|  D  |  O  |_|  |_|    |  |_  |  || |___|    _]__  |"
echo "|     |     | |  |      |   _] |  ||     |   [_/  \ |"
echo "|     |     | |  |      |  |   |  ||     |     \    |"
echo "|_____|\___/  |__|      |__|  |____|_____|_____|\___|"

echo "==> Here we go..."
echo "==> Thanks to Chris Hunt and others for making these files so great!"
cd ~

function install_for_osx(){
  echo "  > Updating homebrew..."
  brew update &> /dev/null

  echo "  > Installing reattach-to-user-namespace..."
  if command -v reattach-to-user-namespace >/dev/null 2>&1; then
    echo "    > (Skipping) Already installed."
  else
    brew install reattach-to-user-namespace &> /dev/null
  fi
}

function install_for_linux(){
  echo "Linux detected, updating pacakges..."
  sudo apt-get update        # Fetches the list of available updates
  sudo apt-get upgrade       # Strictly upgrades the current packages
  sudo apt-get dist-upgrade  # Installs updates (new ones)
  echo "Installing Git..."
  sudo apt-get install git-core
  echo "Removing system vim and replacing it with gtk"
  sudo apt-get purge vim gvim vim-gtk
  sudo apt-get install vim-gtk
  echo "Symlinking dot files"
  ln -s ~/dotfiles/.vimrc ~/.vimrc
  ln -s ~/dotfiles/.oh-my-zsh ~/.oh-my-zsh
  ln -s ~/dotfiles/.tmux.conf ~/.tmux.conf
  ln -s ~/dotfiles/.tmux.conf ~/.tmux.conf
  ln -s ~/dotfiles/.zshrc ~/.zshrc
}

case "$OSTYPE" in
  darwin*)  install_for_osx ;;
  linux*)   install_for_linux ;;
  *)        echo "unknown: $OSTYPE" ;;
esac

echo "  > Updating all git submodules..."
git submodule init &> /dev/null
git submodule update &> /dev/null

echo "==> Done with setup."
